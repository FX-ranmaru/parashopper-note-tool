<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ‘ãƒ©ã‚·ãƒ§ãƒƒãƒ‘ãƒ¼ã‚º noteè¨˜äº‹ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
<style>
:root {
  --bg: #0d0d0f;
  --surface: #15151a;
  --surface2: #1e1e26;
  --border: #2a2a38;
  --accent: #f5a623;
  --accent2: #e8304a;
  --text: #e8e8f0;
  --muted: #888899;
  --success: #3ecf8e;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
  font-size: 14px;
  min-height: 100vh;
}

.header {
  padding: 14px 20px;
  border-bottom: 1px solid var(--border);
  background: var(--surface);
  display: flex; align-items: center; gap: 10px;
  position: sticky; top: 0; z-index: 100;
}
.header h1 { font-size: 1.2rem; color: var(--accent); font-weight: 900; letter-spacing: 2px; }
.header p { font-size: 0.68rem; color: var(--muted); }

/* ===== ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ ===== */
.main { max-width: 680px; margin: 0 auto; padding: 20px 16px 100px; }

.stitle {
  font-size: 0.62rem; font-weight: 700; letter-spacing: 2px;
  text-transform: uppercase; color: var(--muted);
  margin-bottom: 12px; display: flex; align-items: center; gap: 8px;
}
.stitle::after { content:''; flex:1; height:1px; background:var(--border); }

/* ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤º */
.steps-visual {
  display: flex; align-items: center; gap: 0;
  margin-bottom: 24px; background: var(--surface);
  border: 1px solid var(--border); border-radius: 10px; overflow: hidden;
}
.sv-item {
  flex: 1; padding: 12px 8px; text-align: center;
  font-size: 0.7rem; color: var(--muted); line-height: 1.4;
  border-right: 1px solid var(--border);
}
.sv-item:last-child { border-right: none; }
.sv-item.active { background: rgba(245,166,35,0.08); color: var(--accent); }
.sv-item .sv-num {
  display: inline-flex; align-items: center; justify-content: center;
  width: 20px; height: 20px; border-radius: 50%;
  background: var(--border); color: var(--muted);
  font-size: 0.65rem; font-weight: 700; margin-bottom: 4px;
}
.sv-item.active .sv-num { background: var(--accent); color: #000; }
.sv-icon { font-size: 1.2rem; display: block; margin-bottom: 3px; }

/* ã‚«ãƒ¼ãƒ‰ */
.card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 10px; padding: 18px; margin-bottom: 14px;
}
.card-title {
  font-size: 0.85rem; font-weight: 700; color: var(--accent);
  margin-bottom: 12px; display: flex; align-items: center; gap: 8px;
}

/* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ */
.upload-label {
  display: block; border: 2px dashed var(--border);
  border-radius: 10px; padding: 24px 16px;
  text-align: center; cursor: pointer;
  background: var(--surface2); transition: all 0.2s;
}
.upload-label:hover, .upload-label.drag {
  border-color: var(--accent); background: rgba(245,166,35,0.05);
}
#imgInput { display: none; }
.upload-icon { font-size: 1.8rem; display: block; margin-bottom: 6px; }
.upload-label p { color: var(--muted); line-height: 1.6; font-size: 0.8rem; }
.upload-label strong { color: var(--accent); }

.thumb-header {
  display: flex; justify-content: space-between; align-items: center;
  margin: 10px 0 6px;
}
.img-count { font-size: 0.72rem; color: var(--muted); }
.img-count span { color: var(--accent); font-weight: 700; }
.thumb-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
.thumb {
  position: relative; aspect-ratio: 3/4;
  border-radius: 5px; overflow: hidden;
  border: 1px solid var(--border); background: var(--surface2);
  cursor: grab; user-select: none;
}
.thumb img { width:100%; height:100%; object-fit:cover; pointer-events:none; display:block; }
.thumb-n {
  position:absolute; top:2px; left:2px;
  background:rgba(0,0,0,0.85); color:#fff;
  font-size:0.55rem; font-weight:700; padding:1px 3px; border-radius:2px;
}
.thumb-x {
  position:absolute; top:2px; right:2px;
  background:var(--accent2); color:#fff; border:none; border-radius:3px;
  width:15px; height:15px; font-size:0.55rem; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
}
.thumb.dragging { opacity:0.25; }
.thumb.over { outline:2px solid var(--accent); }

/* ãƒ•ã‚©ãƒ¼ãƒ  */
.row2 { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:10px; }
.fg { margin-bottom:10px; }
label { display:block; font-size:0.68rem; color:var(--muted); margin-bottom:4px; }
input[type=text], input[type=number] {
  width:100%; background:var(--surface2); border:1px solid var(--border);
  color:var(--text); border-radius:6px; padding:8px 10px;
  font-family:inherit; font-size:0.85rem; outline:none;
}
input:focus { border-color:var(--accent); }

/* ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ */
.aff-row { display:flex; align-items:center; gap:7px; margin-bottom:6px; }
.vol-tag { font-size:0.62rem; font-weight:700; color:var(--accent); background:rgba(245,166,35,0.12); padding:2px 5px; border-radius:3px; min-width:26px; text-align:center; flex-shrink:0; }
.aff-in { flex:1; background:var(--surface2); border:1px solid var(--border); color:var(--text); border-radius:4px; padding:5px 8px; font-family:inherit; font-size:0.72rem; outline:none; }
.aff-in:focus { border-color:var(--accent); }

/* ãƒœã‚¿ãƒ³ */
.btn { display:inline-flex; align-items:center; justify-content:center; gap:6px; padding:10px 16px; border-radius:8px; font-family:inherit; font-size:0.85rem; font-weight:700; cursor:pointer; border:none; transition:all 0.15s; text-decoration:none; }
.btn-main { background:var(--accent); color:#000; width:100%; padding:14px; font-size:0.95rem; }
.btn-main:hover { background:#ffc04d; }
.btn-main:disabled { background:var(--border); color:var(--muted); cursor:not-allowed; }
.btn-sub { background:transparent; color:var(--muted); border:1px solid var(--border); font-size:0.78rem; padding:8px 14px; }
.btn-sub:hover { border-color:var(--accent); color:var(--accent); }
.btn-claude { background: linear-gradient(135deg, #cc785c, #b85c3a); color:#fff; width:100%; padding:16px; font-size:1rem; border-radius:10px; box-shadow: 0 4px 20px rgba(204,120,92,0.4); }
.btn-claude:hover { background: linear-gradient(135deg, #d98870, #cc785c); transform: translateY(-1px); box-shadow: 0 6px 24px rgba(204,120,92,0.5); }
.btn-copy { background:var(--success); color:#000; padding:9px 16px; font-size:0.78rem; }
.btn-del { background:transparent; border:1px solid var(--border); color:var(--muted); padding:8px 12px; font-size:0.72rem; }
.btn-del:hover { border-color:var(--accent2); color:var(--accent2); }
.btn-row { display:flex; gap:8px; margin-top:8px; flex-wrap:wrap; }

/* ãƒ’ãƒ³ãƒˆ */
.tip { font-size:0.68rem; color:var(--muted); line-height:1.5; background:rgba(245,166,35,0.04); border-left:2px solid var(--accent); padding:6px 10px; border-radius:0 4px 4px 0; margin-bottom:10px; }
.vinfo { display:none; font-size:0.68rem; color:var(--muted); padding:5px 10px; background:rgba(245,166,35,0.05); border-left:2px solid var(--accent); border-radius:0 4px 4px 0; margin-bottom:10px; }

/* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‡ºåŠ› */
.prompt-out {
  background:var(--bg); border:1px solid var(--border);
  border-radius:8px; padding:14px;
  font-size:0.75rem; line-height:1.7;
  white-space:pre-wrap; word-break:break-word;
  color:var(--text); max-height:200px; overflow-y:auto;
}

/* Claudeã¸é€ã‚‹ãƒœãƒƒã‚¯ã‚¹ */
.claude-box {
  background: linear-gradient(135deg, rgba(204,120,92,0.08), rgba(184,92,58,0.05));
  border: 1px solid rgba(204,120,92,0.3);
  border-radius: 12px; padding: 18px; margin-bottom: 14px;
}
.claude-box-title {
  font-size: 0.9rem; font-weight: 700; color: #cc785c;
  margin-bottom: 6px; display: flex; align-items: center; gap: 8px;
}
.claude-box p { font-size: 0.75rem; color: var(--muted); line-height: 1.6; margin-bottom: 12px; }

/* æ‰‹é †ãƒªã‚¹ãƒˆ */
.how-list { list-style:none; padding:0; }
.how-list li {
  display:flex; gap:10px; margin-bottom:10px;
  font-size:0.78rem; color:var(--muted); line-height:1.6; align-items:flex-start;
}
.how-num {
  background:var(--accent); color:#000; font-weight:700; font-size:0.65rem;
  width:18px; height:18px; border-radius:50%;
  display:flex; align-items:center; justify-content:center; flex-shrink:0; margin-top:1px;
}

/* ã‚³ãƒ”ãƒ¼æˆåŠŸ */
.copied-msg { color:var(--success); font-size:0.72rem; display:none; }
.copied-msg.on { display:inline; }

/* ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³æŠ˜ã‚ŠãŸãŸã¿ */
.aff-toggle { cursor:pointer; display:flex; align-items:center; gap:8px; }
.aff-toggle .arrow { transition:transform 0.2s; }
.aff-toggle.open .arrow { transform:rotate(90deg); }
.aff-body { display:none; margin-top:10px; }
.aff-body.open { display:block; }

::-webkit-scrollbar { width:4px; }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }

/* ã‚¹ãƒ†ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰ */
.step-guide { display:flex; flex-direction:column; gap:0; }
.sg-item {
  display:flex; gap:12px; padding:14px 0;
  border-bottom:1px solid var(--border); opacity:0.45;
  transition:opacity 0.2s;
}
.sg-item:last-child { border-bottom:none; }
.sg-item.active, .sg-item.done { opacity:1; }
.sg-num {
  width:28px; height:28px; border-radius:50%;
  background:var(--border); color:var(--muted);
  font-size:0.72rem; font-weight:700; flex-shrink:0;
  display:flex; align-items:center; justify-content:center;
}
.sg-item.active .sg-num { background:var(--accent); color:#000; }
.sg-item.done .sg-num { background:var(--success); color:#000; }
.sg-body { flex:1; }
.sg-title { font-size:0.85rem; font-weight:700; color:var(--text); margin-bottom:4px; }
.sg-desc { font-size:0.72rem; color:var(--muted); line-height:1.5; }
.sg-check { display:none; font-size:0.7rem; color:var(--success); font-weight:700; margin-top:4px; }
.sg-item.done .sg-check { display:block; }
.sg-highlight {
  display:inline-block; margin-top:8px;
  background:rgba(245,166,35,0.12); border:1px solid rgba(245,166,35,0.3);
  color:var(--accent); font-size:0.8rem; font-weight:700;
  padding:6px 12px; border-radius:6px;
}
.sg-note {
  margin-top:8px; font-size:0.68rem; color:var(--muted);
  background:rgba(232,48,74,0.06); border-left:2px solid var(--accent2);
  padding:6px 10px; border-radius:0 4px 4px 0; line-height:1.6;
}
</style>
</head>
<body>

<div class="header">
  <h1>âš¡ PARA NOTE GEN</h1>
  <p>ãƒ‘ãƒ©ã‚·ãƒ§ãƒƒãƒ‘ãƒ¼ã‚º noteè¨˜äº‹ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</p>
</div>

<div class="main">

  <!-- ã‚¹ãƒ†ãƒƒãƒ—ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ« -->
  <div class="steps-visual">
    <div class="sv-item active">
      <span class="sv-num">1</span>
      <span class="sv-icon">ğŸ–¼ï¸</span>
      <div>ç”»åƒã‚’<br>é¸ã¶</div>
    </div>
    <div class="sv-item active">
      <span class="sv-num">2</span>
      <span class="sv-icon">âœï¸</span>
      <div>è©±æ•°ã‚’<br>å…¥åŠ›</div>
    </div>
    <div class="sv-item active">
      <span class="sv-num">3</span>
      <span class="sv-icon">ğŸ“‹</span>
      <div>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ<br>ã‚³ãƒ”ãƒ¼</div>
    </div>
    <div class="sv-item active">
      <span class="sv-num">4</span>
      <span class="sv-icon">ğŸ¤–</span>
      <div>Claudeã§<br>è¨˜äº‹ç”Ÿæˆ</div>
    </div>
  </div>

  <!-- STEP1: ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
  <div class="card">
    <div class="card-title">ğŸ–¼ï¸ STEP 1 â”€â”€ æ¼«ç”»ãƒšãƒ¼ã‚¸ã‚’é¸ã¶ï¼ˆæœ€å¤§30æšï¼‰</div>
    <label class="upload-label" id="dropzone">
      <input type="file" id="imgInput" accept="image/*" multiple>
      <span class="upload-icon">ğŸ“‚</span>
      <p><strong>ã‚¿ãƒƒãƒ—ã—ã¦ç”»åƒã‚’é¸æŠ</strong><br>
      JPGãƒ»PNGå¯¾å¿œ ï¼ æœ€å¤§30æš<br>
      <span style="font-size:0.65rem;opacity:0.6;">ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ã‚‚OK</span></p>
    </label>
    <div id="thumbWrap" style="display:none;">
      <div class="thumb-header">
        <p class="img-count">é¸æŠæ¸ˆï¼š<span id="imgCount">0</span>æš</p>
        <div style="display:flex;gap:6px;">
          <button class="btn btn-sub" style="font-size:0.65rem;padding:4px 8px;" onclick="document.getElementById('imgInput').click()">ï¼‹è¿½åŠ </button>
          <button class="btn btn-del" style="padding:4px 8px;" onclick="clearAll()">å…¨å‰Šé™¤</button>
        </div>
      </div>
      <div class="tip">ğŸ“Œ ã‚µãƒ ãƒã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦é †ç•ªã‚’å…¥ã‚Œæ›¿ãˆã‚‰ã‚Œã¾ã™</div>
      <div class="thumb-grid" id="thumbGrid"></div>
    </div>
  </div>

  <!-- STEP2: è©±æ•°å…¥åŠ› -->
  <div class="card">
    <div class="card-title">âœï¸ STEP 2 â”€â”€ è©±æ•°ã‚’å…¥åŠ›ã™ã‚‹</div>
    <div class="row2">
      <div class="fg">
        <label>è©±æ•°ï¼ˆå¿…é ˆï¼‰</label>
        <input type="number" id="epNum" placeholder="ä¾‹: 2" min="1" oninput="onChange()">
      </div>
      <div class="fg">
        <label>ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä»»æ„ï¼‰</label>
        <input type="text" id="epTitle" placeholder="ä¾‹: è¿½ã‚ã‚Œã‚‹å¤©è‰¯æœ¨" oninput="onChange()">
      </div>
    </div>
    <div class="vinfo" id="vinfo"></div>
  </div>

  <!-- ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆï¼ˆæŠ˜ã‚ŠãŸãŸã¿ï¼‰ -->
  <div class="card">
    <div class="card-title aff-toggle" id="affToggle" onclick="toggleAff()">
      ğŸ”— ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯è¨­å®šï¼ˆä»»æ„ï¼‰<span class="arrow" style="margin-left:auto;color:var(--muted);">â€º</span>
    </div>
    <div class="aff-body" id="affBody">
      <p style="font-size:0.68rem;color:var(--muted);margin-bottom:10px;">9è©±ã”ã¨ã«è‡ªå‹•åˆ‡æ›¿ã€‚ä¸€åº¦è¨­å®šã™ã‚‹ã¨æ¬¡å›ã‚‚ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
      <div id="affLinks"></div>
      <div class="btn-row" style="margin-top:8px;">
        <button class="btn btn-sub" onclick="saveAff()">ğŸ’¾ ä¿å­˜ã™ã‚‹</button>
        <span id="affSaved" style="font-size:0.72rem;color:var(--success);display:none;align-self:center;">âœ“ ä¿å­˜ã—ã¾ã—ãŸ</span>
      </div>
    </div>
  </div>

  <!-- STEP3: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ & Claudeé€ä¿¡ -->
  <div class="card" id="step3card">
    <div class="card-title">ğŸ“‹ STEP 3 â”€â”€ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦Claudeã¸</div>

    <div id="promptSection" style="display:none;">
      <div class="prompt-out" id="promptOut"></div>
      <div class="btn-row" style="margin-top:10px; margin-bottom:16px;">
        <button class="btn btn-copy" onclick="copyPrompt()">ğŸ“‹ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
        <span class="copied-msg" id="copiedMsg">âœ“ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</span>
      </div>
    </div>

    <div id="noPromptMsg" style="font-size:0.78rem;color:var(--muted);margin-bottom:14px;">
      â†‘ è©±æ•°ã‚’å…¥åŠ›ã™ã‚‹ã¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™
    </div>

    <!-- Claudeã¸é€ä¿¡ã‚¬ã‚¤ãƒ‰ -->
    <div class="claude-box" id="claudeGuide">
      <div class="claude-box-title">ğŸ¤– Claudeã§è¨˜äº‹ã‚’ç”Ÿæˆã™ã‚‹æ‰‹é †</div>

      <div class="step-guide">

        <div class="sg-item active" id="sg1">
          <div class="sg-num">1</div>
          <div class="sg-body">
            <div class="sg-title">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹</div>
            <div class="sg-desc">ä¸Šã®ã€ŒğŸ“‹ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—</div>
            <div class="sg-check" id="check1">âœ“ ã‚³ãƒ”ãƒ¼æ¸ˆã¿</div>
          </div>
        </div>

        <div class="sg-item" id="sg2">
          <div class="sg-num">2</div>
          <div class="sg-body">
            <div class="sg-title">Claudeã®ãƒãƒ£ãƒƒãƒˆç”»é¢ã‚’é–‹ã</div>
            <div class="sg-desc">â†“ ã®ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦Claudeã‚’é–‹ã</div>
            <a href="https://claude.ai/new" target="_blank" class="btn btn-claude" style="margin-top:10px;font-size:0.85rem;padding:12px;">
              ğŸ¤– Claudeã‚’é–‹ãï¼ˆæ–°ã—ã„ãƒãƒ£ãƒƒãƒˆï¼‰
            </a>
          </div>
        </div>

        <div class="sg-item" id="sg3">
          <div class="sg-num">3</div>
          <div class="sg-body">
            <div class="sg-title">ç”»åƒã‚’æ·»ä»˜ã™ã‚‹</div>
            <div class="sg-desc">Claudeã®å…¥åŠ›æ¬„å·¦ä¸‹ã®</div>
            <div class="sg-highlight">ï¼‹ ãƒœã‚¿ãƒ³ â†’ å†™çœŸã‚’é¸æŠ</div>
            <div class="sg-desc" style="margin-top:4px;">ã“ã®ãƒ„ãƒ¼ãƒ«ã§é¸ã‚“ã ç”»åƒã¨<strong style="color:var(--text);">åŒã˜ç”»åƒ</strong>ã‚’ã“ã“ã§æ·»ä»˜ã—ã¦ãã ã•ã„</div>
            <div class="sg-note">âš ï¸ ç”»åƒã¯ã“ã®ãƒ„ãƒ¼ãƒ«ã‹ã‚‰ã¯è‡ªå‹•é€ä¿¡ã§ãã¾ã›ã‚“ã€‚<br>å†™çœŸã‚¢ãƒ—ãƒªã‹ã‚‰åŒã˜ç”»åƒã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</div>
          </div>
        </div>

        <div class="sg-item" id="sg4">
          <div class="sg-num">4</div>
          <div class="sg-body">
            <div class="sg-title">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¦é€ä¿¡</div>
            <div class="sg-desc">Claudeã®å…¥åŠ›æ¬„ã‚’é•·æŠ¼ã— â†’ã€Œãƒšãƒ¼ã‚¹ãƒˆã€â†’ é€ä¿¡ãƒœã‚¿ãƒ³ï¼ˆâ†‘ï¼‰ã‚’ã‚¿ãƒƒãƒ—</div>
            <div class="sg-highlight">ã“ã‚Œã§è¨˜äº‹ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ï¼</div>
          </div>
        </div>

      </div>
    </div>
  </div>

</div><!-- /main -->

<script>
var images = [];
var dragIdx = null;
var MAX = 30;

// ===== ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ =====
var inp = document.getElementById('imgInput');
var zone = document.getElementById('dropzone');

inp.addEventListener('change', function() { addFiles(this.files); this.value = ''; });
zone.addEventListener('dragover', function(e) { if (dragIdx !== null) return; e.preventDefault(); zone.classList.add('drag'); });
zone.addEventListener('dragleave', function() { zone.classList.remove('drag'); });
zone.addEventListener('drop', function(e) {
  if (dragIdx !== null) return;
  e.preventDefault(); zone.classList.remove('drag');
  addFiles(e.dataTransfer.files);
});

function addFiles(files) {
  var arr = Array.from(files);
  var remain = MAX - images.length;
  if (remain <= 0) { alert('æœ€å¤§' + MAX + 'æšã¾ã§ã§ã™'); return; }
  arr.slice(0, remain).forEach(function(f) {
    var r = new FileReader();
    r.onload = function(e) {
      images.push({ dataUrl: e.target.result, name: f.name });
      renderThumbs();
      onChange();
    };
    r.readAsDataURL(f);
  });
}

function renderThumbs() {
  var grid = document.getElementById('thumbGrid');
  var wrap = document.getElementById('thumbWrap');
  grid.innerHTML = '';
  if (images.length === 0) { wrap.style.display = 'none'; return; }
  wrap.style.display = 'block';
  document.getElementById('imgCount').textContent = images.length;

  images.forEach(function(img, i) {
    var d = document.createElement('div');
    d.className = 'thumb';
    d.draggable = true;
    d.innerHTML = '<img src="' + img.dataUrl + '"><span class="thumb-n">' + (i+1) + '</span><button class="thumb-x" onclick="delImg(' + i + ')">âœ•</button>';

    // ãƒã‚¦ã‚¹ãƒ‰ãƒ©ãƒƒã‚°
    d.addEventListener('dragstart', function(e) { dragIdx = i; setTimeout(function(){ d.classList.add('dragging'); }, 0); e.dataTransfer.effectAllowed = 'move'; });
    d.addEventListener('dragend', function() { dragIdx = null; d.classList.remove('dragging'); document.querySelectorAll('.thumb').forEach(function(t){ t.classList.remove('over'); }); });
    d.addEventListener('dragover', function(e) { e.preventDefault(); document.querySelectorAll('.thumb').forEach(function(t){ t.classList.remove('over'); }); d.classList.add('over'); });
    d.addEventListener('drop', function(e) {
      e.preventDefault(); d.classList.remove('over');
      if (dragIdx === null || dragIdx === i) return;
      var m = images.splice(dragIdx, 1)[0]; images.splice(i, 0, m); dragIdx = null; renderThumbs();
    });

    // ã‚¿ãƒƒãƒï¼ˆiPadï¼‰
    d.addEventListener('touchstart', function() { dragIdx = i; d.classList.add('dragging'); }, { passive: true });
    d.addEventListener('touchmove', function(e) {
      e.preventDefault();
      var t = e.touches[0];
      document.querySelectorAll('.thumb').forEach(function(x){ x.classList.remove('over'); });
      var el = document.elementFromPoint(t.clientX, t.clientY);
      if (el) { var tgt = el.closest('.thumb'); if (tgt && tgt !== d) tgt.classList.add('over'); }
    }, { passive: false });
    d.addEventListener('touchend', function(e) {
      d.classList.remove('dragging');
      document.querySelectorAll('.thumb').forEach(function(x){ x.classList.remove('over'); });
      var t = e.changedTouches[0];
      var el = document.elementFromPoint(t.clientX, t.clientY);
      if (el) {
        var tgt = el.closest('.thumb');
        if (tgt && tgt !== d) {
          var ti = parseInt(tgt.querySelector('.thumb-n').textContent) - 1;
          if (!isNaN(ti) && ti !== i) { var m = images.splice(i, 1)[0]; images.splice(ti, 0, m); renderThumbs(); }
        }
      }
      dragIdx = null;
    });

    grid.appendChild(d);
  });
}

function delImg(i) { images.splice(i, 1); renderThumbs(); onChange(); }
function clearAll() { images = []; renderThumbs(); onChange(); }

// ===== ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ =====
function onChange() {
  loadAff();
  var ep = parseInt(document.getElementById('epNum').value) || 0;
  var title = document.getElementById('epTitle').value.trim();
  var pOut = document.getElementById('promptOut');
  var pSec = document.getElementById('promptSection');
  var noMsg = document.getElementById('noPromptMsg');
  var vinfo = document.getElementById('vinfo');

  if (!ep) {
    pSec.style.display = 'none';
    noMsg.style.display = 'block';
    vinfo.style.display = 'none';
    return;
  }

  var vol = Math.ceil(ep / 9);
  var affUrl = affData[vol] || '';
  var tPart = title ? 'ã€Œ' + title + 'ã€' : '';
  var imgInfo = images.length > 0 ? 'ï¼ˆç”»åƒ' + images.length + 'æšã‚’æ·»ä»˜ã—ã¾ã™ï¼‰' : 'ï¼ˆç”»åƒã‚’æ·»ä»˜ã—ã¦ãã ã•ã„ï¼‰';
  var affPart = affUrl ? '\n\nè¨˜äº‹æœ«å°¾ã«ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’è‡ªç„¶ã«æŒ¿å…¥ã—ã¦ãã ã•ã„ï¼ˆURLãã®ã¾ã¾ï¼‰ï¼š\nâ–¼ã€ãƒ‘ãƒ©ã‚·ãƒ§ãƒƒãƒ‘ãƒ¼ã‚ºã€ç¬¬' + vol + 'å·»ã¯ã“ã¡ã‚‰\n' + affUrl : '';

  vinfo.style.display = 'block';
  vinfo.textContent = 'ğŸ“š ç¬¬' + ep + 'è©± â†’ ç¬¬' + vol + 'å·»ã«ç›¸å½“' + (affUrl ? 'ï¼ˆãƒªãƒ³ã‚¯è¨­å®šæ¸ˆã¿âœ“ï¼‰' : 'ï¼ˆã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯æœªè¨­å®šï¼‰');

  var prompt = 'ã“ã‚Œã¯æ¼«ç”»ã€Œãƒ‘ãƒ©ã‚·ãƒ§ãƒƒãƒ‘ãƒ¼ã‚ºã€ï¼ˆé€±åˆŠå°‘å¹´ã‚µãƒ³ãƒ‡ãƒ¼æ²è¼‰ã€ä½œè€…ï¼šç¦åœ°ç¿¼ï¼‰ç¬¬' + ep + 'è©±' + tPart + 'ã®ãƒšãƒ¼ã‚¸ç”»åƒã§ã™' + imgInfo + 'ã€‚\n\nç”»åƒã‚’èª­ã‚“ã§ã€ä»¥ä¸‹ã®æ§‹æˆã§noteã«æ²è¼‰ã™ã‚‹è¨˜äº‹ã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚\n\nã€æ§‹æˆã€‘\nâ‘  ã‚­ãƒ£ãƒƒãƒãƒ¼ãªã‚¿ã‚¤ãƒˆãƒ«\nâ‘¡ âš ï¸ãƒã‚¿ãƒãƒ¬æ³¨æ„ã®ä¸€è¨€\nâ‘¢ ä»Šè©±ã®ã‚ã‚‰ã™ã˜ï¼ˆèª­è€…ãŒæµã‚Œã‚’è¿½ãˆã‚‹ã‚ˆã†å…·ä½“çš„ã«ã€‚é‡è¦ã‚·ãƒ¼ãƒ³ã¯å¤ªå­—ã§ï¼‰\nâ‘£ è¦‹ã©ã“ã‚ãƒ»æ„Ÿæƒ³ï¼ˆã€Œãªãœã“ã®ã‚·ãƒ¼ãƒ³ãŒç†±ã„ã®ã‹ã€ã‚’ä¸»è¦³çš„ãªç†±é‡ã§ï¼‰\nâ‘¤ æ¬¡è©±ã¸ã®æœŸå¾…ãƒ»å¼•ã\n\nã€ãƒ«ãƒ¼ãƒ«ã€‘\nãƒ»ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼šãƒ‘ãƒ©ã‚·ãƒ§ãƒƒãƒ‘ãƒ¼ã‚ºãŒæ°—ã«ãªã£ã¦ã„ã‚‹äººãƒ»èª­ã¿å§‹ã‚ãŸäºº\nãƒ»ãƒˆãƒ¼ãƒ³ï¼šç†±é‡ã‚ã‚Šã€èª­ã¿ã‚„ã™ãã€ãƒ†ãƒ³ãƒã‚ˆã\nãƒ»æ”¹è¡Œãƒ»å¤ªå­—ã‚’ç©æ¥µçš„ã«ä½¿ã£ã¦noteã§èª­ã¿ã‚„ã™ã\nãƒ»çµµæ–‡å­—ã¯é©åº¦ã«\nãƒ»æœ€å¾Œã«ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°10å€‹ä»¥ä¸Š\nã€€å¿…é ˆï¼š#ãƒ‘ãƒ©ã‚·ãƒ§ãƒƒãƒ‘ãƒ¼ã‚º #ç¦åœ°ç¿¼ #é€±åˆŠå°‘å¹´ã‚µãƒ³ãƒ‡ãƒ¼ #ã‚µãƒ³ãƒ‡ãƒ¼ã†ã‡ã¶ã‚Š\n\nã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰å§‹ã‚ã¦ã€ãã®ã¾ã¾noteã«ã‚³ãƒ”ãƒšã§ãã‚‹å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚' + affPart;

  pOut.textContent = prompt;
  pSec.style.display = 'block';
  noMsg.style.display = 'none';
}

function copyPrompt() {
  var text = document.getElementById('promptOut').textContent;
  if (!text) return;
  navigator.clipboard.writeText(text).then(function() {
    var el = document.getElementById('copiedMsg');
    el.className = 'copied-msg on';
    setTimeout(function(){ el.className = 'copied-msg'; }, 2500);
    // ã‚¹ãƒ†ãƒƒãƒ—1å®Œäº† â†’ ã‚¹ãƒ†ãƒƒãƒ—2ã€œ4ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
    document.getElementById('sg1').className = 'sg-item done';
    document.getElementById('sg2').className = 'sg-item active';
    document.getElementById('sg3').className = 'sg-item active';
    document.getElementById('sg4').className = 'sg-item active';
    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤º
    document.getElementById('claudeGuide').scrollIntoView({ behavior: 'smooth', block: 'start' });
  });
}

// ===== ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ =====
var affData = {};
function loadAff() {
  try { var s = localStorage.getItem('para_aff'); if (s) affData = JSON.parse(s); } catch(e) {}
  if (!affData[1]) affData[1] = 'https://amzn.to/3MO2hjh';
}
function saveAff() {
  for (var v = 1; v <= 8; v++) { var el = document.getElementById('aff'+v); if (el) affData[v] = el.value.trim(); }
  try { localStorage.setItem('para_aff', JSON.stringify(affData)); } catch(e) {}
  var el = document.getElementById('affSaved');
  el.style.display = 'inline';
  setTimeout(function(){ el.style.display = 'none'; }, 2000);
  onChange();
}
function toggleAff() {
  var toggle = document.getElementById('affToggle');
  var body = document.getElementById('affBody');
  toggle.classList.toggle('open');
  body.classList.toggle('open');
  if (body.classList.contains('open')) renderAff();
}
function renderAff() {
  loadAff();
  var c = document.getElementById('affLinks'); c.innerHTML = '';
  for (var v = 1; v <= 8; v++) {
    var row = document.createElement('div'); row.className = 'aff-row';
    row.innerHTML = '<span class="vol-tag">' + v + 'å·»</span><input class="aff-in" type="text" id="aff' + v + '" placeholder="https://amzn.to/..." value="' + (affData[v] || '') + '">';
    c.appendChild(row);
  }
}

loadAff();
</script>
</body>
</html>
